# Linux进程(process)与任务(Task)

## Linux进程(process)
程序就是我们日常所写的代码。而进程是程序在计算机中运行的实体。程序被加载到计算机内存中运行，即进行中的程序。不同进程间有用独立的内存。

当我们在Linux上运行程序时，Linux会为程序创建一个特殊的环境，该环境包含程序运行需要的所有资源，以保证程序能够独立运行，不受其他程序的干扰。这个特殊的环境就是进程。

每个 Linux 命令都与系统中的程序对应，输入并执行命令，Linux 就会创建一个新的进程来执行。

例如使用`ls`命令遍历目录中的文件时，就创建了一个进程。这个不好看出来，但ps查看进程的时候，我们会发现有ps自己一项，这就是ps命令执行的时候也创建了一个进程。

进程就是程序的实例，系统通过位数字跟踪程序的运行状态，这个数字称为 pid 或进程ID。每个进程都拥有唯一的pid。当数字被用完时，下一个pid就会重新开始，所以pid最终会重复。但是，两个pid一样的进程不能同时存在，因为Linux会使用pid来跟踪程序的运行状态。

## Linux父子进程
在Linux下，父进程创建子进程需要用到fork()函数。
一个进程通过fork()函数，创建一个和自己一样的进程。创建出来的进程子进程，而创建子进程的进程就是父进程。
子进程是父进程的一个副本，是它的复制，两者不共享地址空间。

fork()函数最主要的特点是，调用一次，返回两次。
1.当父进程fork()创建子进程失败时，fork()返回-1。
2.当父进程fork()创建子进程成功时，此时，父进程会返回子进程的pid，而子进程返回的是0。

#### 练习：父子进程
```
echo $$ #查看父进程的PID
bash #启动一个新的进程
echo $$ #查看子进程的PID
echo $PPID  #查看该子进程的父进程的PID
pstree $PPID -p
exit #退出该子进程
echo $$ #查看进程的PID，和第一行的相同
```

## 进程相关命令
### `ps`
选项说明:  
-a 显示所有用户的所有进程。  
-x 显示无终端的进程。  
-u 显示更多信息，类似于 -f 选项。  
-e 显示所有进程。  

```
ps -aux
```

### `kill`命令
当进程运行在前台时，可以通过 kill 命令或 Ctrl+C 组合键来结束进程。
如果进程运行在后台，那么首先要通过 ps 命令来获取进程ID，然后使用 kill 命令“杀死”进程。
例如，用`ps -ef|grep httpd`，来查看httpd进程的PID，然后用`kill`来结束httpd的进程

#### 练习：
```
kill ps -ef|grep httpd
```


### `pstree`
#### 练习：

```
apt install pstree -y
pstree 1
```


## 任务 Task
任务(task)是最抽象的，是一个一般性的术语，指由软件完成的一个活动。一个任务既可以是一个进程，也可以是多个进程。简而言之，它指的是一系列共同达到某一目的的操作。例如，读取数据并将数据放入内存中。这个任务可以由一个进程来实现，也可以由多个进程来实现。 

每个任务都有一个数字表示的任务号。

进程(process)常常被定义为程序的执行。可以把一个进程看成是一个独立的程序，在内存中有其完备的数据空间和代码空间。一个进程所拥有的数据和变量只属于它自己。

jobs 命令可以用来查看系统中正在运行的任务，包括后台运行的任务。该命令可以显示任务号及其对应的进程ID。一个任务可以对应于一个或者多个进程号。

jobs 命令的 -l 选项可以查看当前任务包含的进程ID

```
jobs
```

### 前台进程与后台进程

进程有二种方式：前台进程和后台进程。

默认情况下，用户创建的进程都是前台进程；前台进程从键盘读取数据，并把处理结果输出到显示器。

我们可以看到前台进程的运行过程。例如，使用 ls 命令来遍历当前目录下的文件。

这个程序就运行在前台，它会直接把结果输出到显示器。如果 ls 命令需要数据（实际上不需要），那么会等待用户从键盘输入。当程序运行在前台时，由于命令提示符还未出现，用户不能输入其他命令；使程序需要运行很长时间，也必须等待程序运行结束才能输入其他命令。

后台进程与键盘没有必然的关系。当然，后台进程也可能会等待键盘输入后台进程的优点是不必等待程序运行结束就可以输入其他命令创建后台进程最简单的方式就是在命令的末尾加 &


#### 练习
```
ls &
```

### 前台任务和后台任务的切换

`fg`命令可以将后台任务调到前台，语法为：`fg %jobnumber`,jobnumber 是通过 jobs 命令获取的后台任务的的序号，注意不是pid。如果后台只有一个任务，可以不指定 jobnumber

`bg`命令可以将后台暂停的任务，调到前台继续运行，语法为：`bg %jobnumber`,jobnumber 同样是通过 jobs 命令获取的后台任务的的序号，注意不是pid。如果前台只有一个任务，可以不指定 jobnumber。

如果希望将当前任务转移到后台，可以先 Ctrl+z 暂停任务，再使用`bg`命令。任务转移到后台可以空出终端，继续输入其他命令。

<code title="Linux 进程与任务" description="a" keyword="a">